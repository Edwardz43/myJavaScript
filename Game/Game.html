<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<title>Game</title>    
<head>
<script type="text/javascript" src="jquery.js"></script>
<style>
#myCanvas{
    position: absolute;
    top: 0;
    left: 0;
    width : 1440px; 
    height : 600px;
}
#myBG {
	position: relative;
	width: 1440px;
	height: 600px;
	margin: 0;
	overflow: hidden;
	outline: 1px solid gray;
}

#bGImg {
	position: relative;
	width: 2640px;
	height: 600px;
	background : url('images/BG002.jpg');
	background-repeat: repeat-x;
    animation: rollImage linear 10s infinite;
    z-index:-1;
}


@keyframes rollImage {
	from { right: 0px; }
	to { right: 1200px; }
}

</style>
<body>
<img id="fireBall" src="images/fire01.png" style="display: none"></img>
<div id="myBG">
    <div id="bGImg"></div>
</div>
<div><canvas class="myGame" id="myCanvas"></canvas></div>
<br>
<div id="report"></div>

</body>
<script>
    $(document).ready(function(){
        var canvas = $('#myCanvas')[0];
        var ctx = canvas.getContext('2d');
        var gameLoop;
        var balls = [];
        var fireSound = new Audio('BGM/wing1.mp3');
        fireSound.volume = 0.3;
        var dImg = new Image();
         
        var dragon = {
            Level : 1,
            X : 100,
            Y : 100,
            Dx :0,
            Dy :0,
            SpeedX : 1,
            width : 30,
            height : 30,
            Move : "none",
            shot : function (){
                balls.push(new Ball(dragon.X + 25, dragon.Y + 15 -dragon.Level));
                fireSound.play();
            }
        }
        
        
        function moveDragon(){
            switch(dragon.Move) {
                case 'LEFT':
                    dragon.Dx = -dragon.SpeedX;
                    break;
                case 'UP':
                    dragon.Dy = -dragon.SpeedX;
                    break;    
                case 'RIGHT':
                    dragon.Dx = dragon.SpeedX;
                    break;
                case 'DOWN':
                    dragon.Dy = dragon.SpeedX;
                    break;    
                case 'l-NONE':
                case 'r-NONE':
                    dragon.Dx = 0;
                    break;
                case 'u-NONE':
                case 'd-NONE':
                    dragon.Dy = 0;
                    break;
            }
            //bug
            if (dragon.X + dragon.Dx < 0 || dragon.X + dragon.Dx +dragon.Width >= 200){
                dragon.Dx = 0; 
            }
            if (dragon.Y + dragon.Dy < 0 || dragon.Y + dragon.Dy +dragon.height > canvas.height){
                dragon.Dy = 0; 
            }
            dragon.X = dragon.X + dragon.Dx;
            dragon.Y = dragon.Y + dragon.Dy;
        }
        
        var count = 1;
        
        function drawDragon(){
            if (count >= 5) count = 1;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            dImg.src = 'images/dR0' + count + '_burned.png',
            ctx.drawImage(dImg, dragon.X, dragon.Y, dragon.width, dragon.height);
            count++;
        }
        
        function Ball(X, Y){
            this.X = X;
            this.Y = Y;
            this.width = 18 + dragon.Level;   
            this.height = 9 + dragon.Level;
            this.DeltaX = 3;
        }
            
        function moveBall(ballI){
            var ball = ballI;
            // First check if we will bump into something
            // If top of the ball touches the top then reverse Y direction
            if(ball != null){
                // if (ball.Y + ball.DeltaY - ball.Radius < 0 
                //     // or if ball collides in Y direction with bricks
                //     || collisionYWithBricks(ball)){
                //     ball.DeltaY *= -1;
                //     bouncingSound.play();
                // }
                // If the bottom of the ball touches the bottom of the screen then end the game
                if (ball.X + ball.DeltaX + ball.Radius > canvas.width){
                    delete balls[ball.number];
                    //dropingSound.play();
                    //loseBall++;
                }
                // If side of ball touches either side of the wall then reverse X direction
                    //left of ball moves too far left
                // if ((ball.X + ball.DeltaX - ball.Radius < 0) ||
                //     //or right side of ball moves too far right
                // (ball.X + ball.DeltaX + ball.Radius > canvas.width)
                // // or if ball collides in Y direction with bricks
                // || collisionXWithBricks(ball)
                // ){  
                //     ball.DeltaX *= -1;
                //     bouncingSound.play();
                // }
                // // if bottom of ball reaches the top of paddle,
                // if ((ball.Y + ball.DeltaY + ball.Radius >= paddle.Y)){//||(ball.Y + ball.DeltaY + ball.Radius < paddle.Y)
                //     // and it is positioned between the two ends of the paddle (is on top)
                //     if (ball.X + ball.DeltaX >= paddle.X && 
                //         ball.X + ball.DeltaX <= paddle.X + paddle.Width){
                //         ball.DeltaY *= -1;
                //         bouncingSound.play();
                //     }
                // }
                // Move the ball
                ball.X += ball.DeltaX;
            }
        }
        
        function drawBall(ballI) {
            //如果球被刪除了  就=null 那就不必畫了
            if(ballI != null){
                var ball = ballI;
            	ctx.save();
            	var fire = document.getElementById('fireBall');
                ctx.drawImage(fire, ball.X, ball.Y, ball.width, ball.height);
                ctx.restore();
            }
        }
    
        
        function animate(){
           
            moveDragon();
            for(var i=0; i<balls.length; i++){
                //ctx.clearRect(balls[i].X, balls[i].Y, 20, 10)
                moveBall(balls[i]);  
                drawBall(balls[i]);
            }
            var s = "X :" + dragon.X + ", Y :"+dragon.Y + ", c.width :" + canvas.width+ ", c.height :" + canvas.height;
            $("#report").text(s);
        }
        
        function startGame(){
            
            gameLoop = setInterval(animate, 20);
            setInterval(drawDragon, 100);
            
            
            
            
            
            
            $(document).keydown(function(evt) {
                switch (evt.keyCode) {
                    case 32:
                        dragon.shot();
                        break;
                    case 37:
                        dragon.Move = 'LEFT';
                        break;
                    case 38:
                        dragon.Move = 'UP';
                        break;
                    case 39:
                        dragon.Move = 'RIGHT';
                        break;
                    case 40:
                        dragon.Move = 'DOWN';
                        break;
                    
                    default:
                        dragon.Move = 'NONE';
                }
            });         
            
            $(document).keyup(function(evt) {
                switch (evt.keyCode) {
                    case 37:
                        dragon.Move = 'l-NONE';
                        break;
                    case 38:
                        dragon.Move = 'u-NONE';
                        break;
                    case 39:
                        dragon.Move = 'r-NONE';
                        break;
                    case 40:
                        dragon.Move = 'd-NONE';
                        break;
                    default:
                        dragon.Move = 'NONE';
                }
            }); 
        }
        startGame();

    });
</script>
</head>
</html>